%带通滤波器
%
%  * 离散时间 IIR 滤波器(实数)
%  * ----------------
%  * 滤波器结构  : 直接 II 型，二阶节
%  * 节数     : 16
%  * 稳定     : 是
%  * 线性相位   : 否
%  * 采样率：1MHz
%  * 上限频率：1kHz
%  * 下限频率：500Hz
%

%定义滤波器分子和分母系数
NUM = {[0.002826646365552, 0, 0],
    [1, 0, -1],
    [0.002826646365552, 0, 0],
    [1, 0, -1],
    [0.002825111843642, 0, 0],
    [1, 0, -1],
    [0.002825111843642, 0, 0],
    [1, 0, -1],
    [0.002823668639123, 0, 0],
    [1, 0, -1],
    [0.002823668639123, 0, 0],
    [1, 0, -1],
    [0.002822371678598, 0, 0],
    [1, 0, -1],
    [0.002822371678598, 0, 0],
    [1, 0, -1],
    [0.00282127010939, 0, 0],
    [1, 0, -1],
    [0.00282127010939, 0, 0],
    [1, 0, -1],
    [0.002820405516257, 0, 0],
    [1, 0, -1],
    [0.002820405516257, 0, 0],
    [1, 0, -1],
    [0.002819810436269, 0, 0],
    [1, 0, -1],
    [0.002819810436269, 0, 0],
    [1, 0, -1],
    [0.002819507212044, 0, 0],
    [1, 0, -1],
    [0.002819507212044, 0, 0],
    [1, 0, -1],
    [1, 0, 0]};

DEN = {
    [1, 0, 0],
    [1, -1.9989536277, 0.9989929834227],
    [1, 0, 0],
    [1, -1.999898591389, 0.9998989871151],
    [1, 0, 0],
    [1, -1.996987800259, 0.9970263038154],
    [1, 0, 0],
    [1, -1.999694740982, 0.999695145076],
    [1, 0, 0],
    [1, -1.995157667816, 0.9951945529941],
    [1, 0, 0],
    [1, -1.999485385372, 0.9994858068274],
    [1, 0, 0],
    [1, -1.993544133008, 0.9935787246762],
    [1, 0, 0],
    [1, -1.999266988299, 0.9992674372989],
    [1, 0, 0],
    [1, -1.999036993606, 0.9990374820715],
    [1, 0, 0],
    [1, -1.992218843302, 0.9922506126295],
    [1, 0, 0],
    [1, -1.998796913725, 0.9987974548979],
    [1, 0, 0],
    [1, -1.991238646025, 0.9912672981819],
    [1, 0, 0],
    [1, -1.998563218253, 0.998563822573],
    [1, 0, 0],
    [1, -1.990632669508, 0.9906583286048],
    [1, 0, 0],
    [1, -1.99839464449, 0.9983953010989],
    [1, 0, 0],
    [1, -1.990373454836, 0.9903970604307],
    [1, 0, 0]};
    
%定义滤波器阶数
Nsec = 33;

% 创建一个滤波器对象
fs = 1e6;  % 假设采样频率为1MHz

%创建一个包含1hz，50hz，100hz，500hz，1000hz，2000hz，5000hz，10khz的信号
t = 0:1/fs:1;  % 1秒的时间向量
signal = sin(2*pi*1*t) + sin(2*pi*50*t) + sin(2*pi*100*t)...
 + sin(2*pi*500*t) + sin(2*pi*1000*t) + sin(2*pi*2000*t)...
+ sin(2*pi*5000*t) + sin(2*pi*10000*t);

%原始信号频谱
signal_fft  = abs(fft(signal));
freq = (0:length(signal)-1)*fs/length(signal);

% 应用滤波器进行处理
filtered_signal = signal;
for i = 1:Nsec
    filtered_signal = filter(NUM{i}, DEN{i}, filtered_signal);
end

%滤波后信号的频谱
filtered_signal_fft = abs(fft(filtered_signal));

% 可视化信号和频谱
figure;

% 时域信号图
subplot(2, 2, 1);
plot(t, signal);
title('Original Signal');
xlabel('Time (s)');
ylabel('Amplitude');

subplot(2, 2, 2);
plot(t, filtered_signal);
title('Filtered Signal');
xlabel('Time (s)');
ylabel('Amplitude');

% 频域图
subplot(2, 2, 3);
plot(freq, signal_fft);
title('Original Signal Spectrum');
xlabel('Frequency (Hz)');
ylabel('Magnitude');
xlim([0 20000]);  % 限制x轴范围，便于观察低频到高频的成分

subplot(2, 2, 4);
plot(freq, filtered_signal_fft);
title('Filtered Signal Spectrum');
xlabel('Frequency (Hz)');
ylabel('Magnitude');
xlim([0 20000]);  % 限制x轴范围，便于观察低频到高频的成分
